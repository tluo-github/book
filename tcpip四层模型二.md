# TCP\/IP 网络互连层IP 协议
> 上TCP/IP四层模型中我们大致了解了下是哪四层及每层大致作用，做为web程序员除了最底层不用太了解从网络互连层(TP协议)->传输层(TCP,UDP)->应用层 都应了解越详细越好，这篇就主要记录我理解的网络互连层 IP 协议



## 1、 网络互连层 IP 协议 定义

网际协议（英语：Internet Protocol，缩写为 IP），或称互联网协议，是用于报文交换网络的一种面向数据的协议。

IP是在TCP/IP协议中网络层的主要协议，任务是仅仅根据源主机和目的主机的地址传送数据。为此目的，IP定义了寻址方法和数据报的封装结构。第一个架构的主要版本，现在称为IPv4，仍然是最主要的互联网协议，尽管世界各地正在积极部署IPv6。




#### 2.1 IP协议



> 在TCP\/IP协议中我们传输层\(TCP,UDP\)、应用层\(FTP,HTTP,SSH\)只需要关系目标主机的IP地址。而在同一局域网中一台主机要喝另一台主机进行直接通信、必须要知道目标主机的mac地址。而如果不在同一局域网中，即便知道目的主机的mac地址，两者也不能直接通信，必须经过路由转发才可以。



2.1.1 ARP 协议



因为IP数据包是放在以太网数据包发送，所以我们必须同时知道2个地址，一个对方的MAC地址，一个对方的IP地址。通常情况下，对方的IP地址是已知的，但是不知道它的MAC地址。所以我们需要一种机制，能够从IP地址获得MAC地址



这里有两种情况：



一 如果两台主机不再同一个局域网，那么事实上没有办法获得对方MAC地址。只能发数据发送到2个网络之间的路由转发。



二 如果在同一个网络中，那么可以使用ARP协议，得到对方的MAC地址。每天电脑或路由器都有一个ARP缓冲表，表里的IP地址与MAC地址是一一对应的。



| 主机名称 | IP地址 | MAC地址 |

| --- | --- | --- |

| A | 192.168.38.10 | 00-AA-00-62-D2-02 |

| B | 192.168.38.11 | 00-BB-00-62-D2-02 |

| C | 192.168.38.12 | 00-CC-00-62-D2-02 |

| ... | ... | ... |



以主机A（192.168.38.10）向主机B（192.168.38.11）发送数据为例。

当发送数据时，主机A会在自己的ARP缓存表中寻找是否有目标IP地址。如果找到就知道目标MAC地址为（00-BB-00-62-C2-02），直接把目标MAC地址写入帧里面发送就可。

如果在ARP缓存表中没有找到相对应的IP地址，主机A就会在网络上发送一个广播（ARP request），目标MAC地址是“FF.FF.FF.FF.FF.FF”，这表示向同一网段内的所有主机发出这样的询问：“192.168.38.11的MAC地址是什么？”网络上其他主机并不响应ARP询问，只有主机B接收到这个帧时，才向主机A做出这样的回应（ARP response）：“192.168.38.11的MAC地址是00-BB-00-62-C2-02”。这样，主机A就知道主机B的MAC地址，它就可以向主机B发送信息。同时它还更新自己的ARP缓存表，下次再向主机B发送信息时，直接从ARP缓存表里查找就可。



小结：ARP协议\( **地址解析协议**（**A**ddress **R**esolution **P**rotocol \) 其基本功能为透过目标设备的IP地址，查询目标设备的MAC地址，以保证通信的顺利进行。




